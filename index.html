<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BWAM</title> <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè¶</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --brand-red: #A6001A; }
        body { font-family: 'Inter', sans-serif; }
        .bg-brand-red { background-color: var(--brand-red); }
        .text-brand-red { color: var(--brand-red); }
        .border-brand-red { border-color: var(--brand-red); }
        .dropdown-menu { display: none; opacity: 0; transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out; transform: translateY(-10px); }
        .group:hover .dropdown-menu { display: block; opacity: 1; transform: translateY(0); }
        /* Ensure active language button is clickable */
        .lang-button.active { font-weight: 700; color: var(--brand-red); }
        section[id] { scroll-margin-top: 70px; }
        html { scroll-behavior: smooth; }
        #consent-banner { transition: transform 0.3s ease-in-out; }
        .login-form-container { display: flex; align-items: center; gap: 0.5rem; }
    </style>

    <script type="text/javascript" src="https://cdn.pc-rnd.c360a.salesforce.com/beacon/c360a/d2799336-52d2-4f39-832b-d481cbc97fed/scripts/c360a.min.js" async></script>

    <script type="text/javascript">
      // Global flags/variables needed before DOM ready or SDK init
      var salesforceSDKInitialized = false;
      var userLocationData = null;
      const CONSENT_STORAGE_KEY = 'bwam_consent_status';

      // --- Function to Initialize Salesforce SDK & Sitemap ---
      // Called only after consent is explicitly accepted.
      function initializeSalesforceSDK() {
          if (salesforceSDKInitialized) { console.log("SF SDK already init."); return; }
          // Ensure the SDK library is loaded before proceeding
          if (typeof SalesforceInteractions === 'undefined' || typeof SalesforceInteractions.init !== 'function') {
              console.error("Salesforce Interactions SDK not ready or loaded yet. Retrying...");
              // Retry initialization after a short delay if the SDK wasn't ready
              setTimeout(initializeSalesforceSDK, 500);
              return;
          }

          console.log("Attempting SF SDK Initialization...");
          SalesforceInteractions.init({
            cookieDomain: "YOUR_COOKIE_DOMAIN" // REPLACE
            // personalization: { dataspace: "YOUR_DATASPACE_NAME" }
          }).then(() => {
            console.log("Salesforce SDK Initialized.");
            salesforceSDKInitialized = true;

            // --- SFDC Account and Dataset Configuration ---
            const config = {
              global: { et: "YOUR_SFDC_ACCOUNT" /* REPLACE */, dataTrack: "1" },
              dataset: "YOUR_DATASET_ID" // REPLACE
            };
            SalesforceInteractions.configure(config);

            // --- Geolocation Request ---
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => { userLocationData = { latitude: pos.coords.latitude, longitude: pos.coords.longitude }; SalesforceInteractions.sendEvent({ interaction: { name: 'Geolocation Obtained' }, user: { attributes: userLocationData } }); console.log("Geolocation obtained:", userLocationData); },
                    (err) => { userLocationData = { error: err.code }; SalesforceInteractions.sendEvent({ interaction: { name: 'Geolocation Denied or Error', attributes: { errorCode: err.code, errorMessage: err.message } } }); console.warn(`Geolocation error: ${err.message}`); },
                    { enableHighAccuracy: false, timeout: 10000, maximumAge: 600000 }
                );
            } else { userLocationData = { error: 'unsupported' }; console.log("Geolocation not supported."); }

            // --- Define Sitemap Configuration ---
            const sitemapConfig = {
                global: {
                    onActionEvent: (event) => {
                        if (!event.page?.referrerUrl) { event.page = { ...event.page, referrerUrl: document.referrer }; }
                        if (userLocationData && !userLocationData.error) { event.user = { ...event.user, attributes: { ...event.user?.attributes, latitude: userLocationData.latitude, longitude: userLocationData.longitude } }; }
                        console.log("Sitemap Global onActionEvent:", event.interaction.name);
                        return event;
                    }
                },
                pageTypes: [ // Page type definitions remain the same as v6
                    { name: "Homepage", isMatch: () => { const h = window.location.hash.substring(1); return h === "" || h === "home"; }, interaction: { name: "View Homepage" }, attributes: { pageCategory: "General Banking" }, onActionEvent: (e) => { console.log("Homepage Action:", e.interaction.name); return e; } },
                    { name: "Services Overview", isMatch: () => window.location.hash === "#services", interaction: { name: "View Services Overview" }, attributes: { pageCategory: "Financial Services" } },
                    { name: "News Overview", isMatch: () => window.location.hash === "#news", interaction: { name: "View News Overview" }, attributes: { pageCategory: "Insights & News" } },
                    { name: "Events Information", isMatch: () => window.location.hash === "#events", interaction: { name: "View Events Information" }, attributes: { pageCategory: "Community & Events" } },
                    { name: "Contact Information", isMatch: () => window.location.hash === "#contact", interaction: { name: "View Contact Information" }, attributes: { pageCategory: "Support & Contact" } },
                    { name: "Service Detail - Accounts & Cards", isMatch: () => window.location.hash === "#accounts-cards", interaction: { name: "View Service Detail" }, attributes: { pageCategory: "Accounts & Cards", serviceKey: "accounts-cards" } },
                    { name: "Service Detail - Investing", isMatch: () => window.location.hash === "#investing", interaction: { name: "View Service Detail" }, attributes: { pageCategory: "Investing", serviceKey: "investing" } },
                    { name: "Service Detail - Pensions", isMatch: () => window.location.hash === "#pensions", interaction: { name: "View Service Detail" }, attributes: { pageCategory: "Pensions", serviceKey: "pensions" } },
                    { name: "Service Detail - Financing", isMatch: () => window.location.hash === "#financing", interaction: { name: "View Service Detail" }, attributes: { pageCategory: "Financing", serviceKey: "financing" } },
                    { name: "Other", isMatch: () => true, interaction: { name: "View Other Page" }, attributes: { pageCategory: "General Banking" } }
                ]
            };

            // Initialize the Sitemap (this triggers the first page view event)
            SalesforceInteractions.initSitemap(sitemapConfig);
            console.log("Salesforce Sitemap Initialized.");

            // --- Initial Login Check & Identification ---
            const loggedInEmail = sessionStorage.getItem('bwam_logged_in_email');
             if (loggedInEmail && typeof handleSuccessfulLogin === 'function') {
                 console.log('User already logged in from session. Identifying.');
                 handleSuccessfulLogin('SIMULATED_USER_123', loggedInEmail);
             }

            // --- Call function in script.js to attach interaction listeners ---
            if (typeof attachTrackingListeners === 'function') {
                attachTrackingListeners();
            } else { console.warn("attachTrackingListeners function not found."); }

          }).catch((error) => { console.error("SF SDK Init/Sitemap Error: ", error); });
      }
      window.initializeSalesforceSDK = initializeSalesforceSDK; // Make global

      // --- Pre-DOM Consent Check ---
      // Only initialize SDK immediately if consent was *already* accepted.
      // Banner display is handled in script.js after DOM loads.
      try {
          const consentStatus = localStorage.getItem(CONSENT_STORAGE_KEY);
          if (consentStatus === 'accepted') {
              console.log('Consent previously accepted. Will init SDK.');
              // Use setTimeout to allow the async SDK script to potentially load first
              setTimeout(initializeSalesforceSDK, 150);
          } else {
              console.log(`Consent status: ${consentStatus || 'Not Set'}. SDK init deferred.`);
          }
      } catch (e) { console.error("localStorage consent check failed.", e); }

    </script>
    </head>
<body class="antialiased text-gray-800 bg-white relative pb-32">
    <header class="bg-white shadow-md sticky top-0 z-50 w-full">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-2">
                <div class="flex-shrink-0">
                    <a href="#home" class="flex items-center">
                        <img src="images/bwam-logo.jpg" alt="BWAM Logo" class="h-10 w-auto mr-2" onerror="this.style.display='none'"> </a>
                </div>

                <nav class="hidden md:flex items-center space-x-5 lg:space-x-7">
                    <div class="group relative">
                        <button class="nav-link text-sm font-medium text-gray-500 hover:text-brand-red inline-flex items-center py-3" data-lang-key="nav.private_clients">
                            Private Clients <svg class="ml-1 h-4 w-4 text-gray-400 group-hover:text-gray-500 transition-transform duration-200 group-hover:rotate-180" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                        </button>
                        <div class="dropdown-menu absolute left-0 mt-0 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-20">
                            <div class="py-1" role="none">
                                <a href="#accounts-cards" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100 hover:text-brand-red" role="menuitem" data-lang-key="nav.accounts_cards">Accounts & Cards</a>
                                <a href="#investing" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100 hover:text-brand-red" role="menuitem" data-lang-key="nav.investing">Investing</a>
                                <a href="#pensions" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100 hover:text-brand-red" role="menuitem" data-lang-key="nav.pensions">Pensions</a>
                                <a href="#financing" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100 hover:text-brand-red" role="menuitem" data-lang-key="nav.financing">Financing</a>
                            </div>
                        </div>
                    </div>
                    <a href="#services" class="nav-link text-sm font-medium text-gray-500 hover:text-brand-red py-3" data-lang-key="nav.business_clients">Business Clients</a>
                    <a href="#" class="nav-link text-sm font-medium text-gray-500 hover:text-brand-red py-3" data-lang-key="nav.institutional">Institutional</a>
                    <a href="#" class="nav-link text-sm font-medium text-gray-500 hover:text-brand-red py-3" data-lang-key="nav.about_us">About Us</a>
                    <a href="#events" class="nav-link text-sm font-medium text-gray-500 hover:text-brand-red py-3" data-lang-key="nav.events">Events</a>
                </nav>

                <div class="flex items-center space-x-3 sm:space-x-4">
                    <button aria-label="Search" class="p-1 text-gray-500 hover:text-brand-red" data-lang-key="aria.search" title="Search">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                    </button>
                    <div id="login-container" class="flex items-center">
                        <button id="login-button" class="text-sm font-medium text-gray-500 hover:text-brand-red" data-lang-key="nav.login">Login</button>
                        <div id="login-form" class="login-form-container hidden ml-2">
                             <input type="email" id="login-email" placeholder="Enter email" class="text-sm border border-gray-300 rounded-md px-2 py-1 focus:outline-none focus:ring-1 focus:ring-brand-red focus:border-brand-red">
                             <button id="simulate-login-button" class="text-sm bg-brand-red text-white py-1 px-3 rounded-md hover:bg-opacity-85">Login</button>
                        </div>
                         <div id="logged-in-status" class="hidden items-center ml-2">
                             <span class="text-sm text-gray-700 mr-2">Logged in: <span id="logged-in-email" class="font-medium"></span></span>
                             <button id="logout-button" class="text-sm font-medium text-gray-500 hover:text-brand-red underline">Logout</button>
                         </div>
                    </div>
                    <div class="border-l pl-3 sm:pl-4 flex space-x-2">
                        <button class="lang-button text-sm font-medium text-gray-500 hover:text-brand-red" data-lang="de">DE</button>
                        <button class="lang-button text-sm font-medium text-gray-500 hover:text-brand-red" data-lang="en">EN</button>
                    </div>
                    <div class="md:hidden">
                         <button id="mobile-menu-button" aria-label="Open menu" class="p-1 text-gray-500 hover:text-brand-red" data-lang-key="aria.open_menu">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
                         </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden absolute top-full left-0 w-full bg-white shadow-lg border-t border-gray-200">
             <div class="px-2 pt-2 pb-3 space-y-1">
                 <a href="#home" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50" data-lang-key="nav.private_clients">Private Clients</a>
                 <a href="#services" class="block px-3 py-2 rounded-md text-base font-medium text-gray-600 hover:bg-gray-50" data-lang-key="nav.business_clients">Business Clients</a>
                 <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-gray-600 hover:bg-gray-50" data-lang-key="nav.institutional">Institutional</a>
                 <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-gray-600 hover:bg-gray-50" data-lang-key="nav.about_us">About Us</a>
                 <a href="#events" class="block px-3 py-2 rounded-md text-base font-medium text-gray-600 hover:bg-gray-50" data-lang-key="nav.events">Events</a>
             </div>
         </div>
    </header>

    <main>
        <section id="home" class="relative h-[60vh] md:h-[75vh] flex items-center text-white overflow-hidden">
            <div class="absolute inset-0 z-0">
                 <img src="https://placehold.co/1920x1080/111827/9ca3af?text=Dynamic+City+Background" alt="Zurich Financial District" class="w-full h-full object-cover" onerror="this.src='https://placehold.co/1920x1080/cccccc/ffffff?text=Image+Not+Found'">
                <div class="absolute inset-0 bg-black opacity-40"></div>
             </div>
            <div class="relative container mx-auto px-4 sm:px-6 lg:px-8 z-10">
                <div class="max-w-2xl">
                    <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold mb-4 leading-tight" data-lang-key="hero.title">Welcome to BWAM</h1>
                    <p class="text-lg sm:text-xl mb-8 text-gray-200" data-lang-key="hero.subtitle">Your trusted partner for comprehensive financial solutions in Z√ºrich and beyond.</p>
                    <div class="flex flex-wrap gap-4">
                        <a href="#services" class="inline-block bg-brand-red text-white font-semibold py-3 px-6 rounded-md hover:bg-opacity-85 transition duration-200 shadow" data-lang-key="hero.button_services">Explore Services</a>
                        <a href="#contact" class="inline-block bg-white text-brand-red font-semibold py-3 px-6 rounded-md hover:bg-gray-100 transition duration-200 shadow" data-lang-key="hero.button_contact">Contact Us</a>
                    </div>
                </div>
            </div>
        </section>

        <section id="services" class="py-12 md:py-20 bg-gray-50">
             <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                 <h2 class="text-3xl lg:text-4xl font-bold text-center mb-12 lg:mb-16" data-lang-key="nav.business_clients">Business Client Services</h2>
                 <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 md:gap-8 text-center">
                    <a href="#accounts-cards" class="group block bg-white p-4 rounded-lg shadow hover:shadow-lg transition-shadow duration-300">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto mb-3 text-brand-red" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" /></svg>
                        <h3 class="text-sm font-semibold text-gray-800 group-hover:text-brand-red" data-lang-key="service_card.accounts_cards">Accounts & Cards</h3>
                    </a>
                    <a href="#investing" class="group block bg-white p-4 rounded-lg shadow hover:shadow-lg transition-shadow duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto mb-3 text-brand-red" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                        <h3 class="text-sm font-semibold text-gray-800 group-hover:text-brand-red" data-lang-key="service_card.investing">Savings & Investments</h3>
                    </a>
                     <a href="#pensions" class="group block bg-white p-4 rounded-lg shadow hover:shadow-lg transition-shadow duration-300">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto mb-3 text-brand-red" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                        <h3 class="text-sm font-semibold text-gray-800 group-hover:text-brand-red" data-lang-key="service_card.pensions">Pensions</h3>
                    </a>
                    <a href="#financing" class="group block bg-white p-4 rounded-lg shadow hover:shadow-lg transition-shadow duration-300">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto mb-3 text-brand-red" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                        <h3 class="text-sm font-semibold text-gray-800 group-hover:text-brand-red" data-lang-key="service_card.financing">Financing</h3>
                    </a>
                    <a href="#" class="group block bg-white p-4 rounded-lg shadow hover:shadow-lg transition-shadow duration-300"> <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto mb-3 text-brand-red" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>
                        <h3 class="text-sm font-semibold text-gray-800 group-hover:text-brand-red" data-lang-key="service_card.real_estate">Real Estate</h3>
                    </a>
                </div>
            </div>
        </section>

        <section id="accounts-cards" class="py-16 lg:py-24 bg-white hidden">
             <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                 <h2 class="text-3xl lg:text-4xl font-bold text-center mb-12" data-lang-key="nav.accounts_cards">Accounts & Cards Details</h2>
                 <p class="text-center text-gray-600">Detailed content about Accounts & Cards would go here...</p>
                 </div>
        </section>
        <section id="investing" class="py-16 lg:py-24 bg-gray-50 hidden">
             <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                 <h2 class="text-3xl lg:text-4xl font-bold text-center mb-12" data-lang-key="nav.investing">Investing Details</h2>
                 <p class="text-center text-gray-600">Detailed content about Investing would go here...</p>
             </div>
        </section>
         <section id="pensions" class="py-16 lg:py-24 bg-white hidden">
             <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                 <h2 class="text-3xl lg:text-4xl font-bold text-center mb-12" data-lang-key="nav.pensions">Pensions Details</h2>
                 <p class="text-center text-gray-600">Detailed content about Pensions would go here...</p>
             </div>
        </section>
         <section id="financing" class="py-16 lg:py-24 bg-gray-50 hidden">
             <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                 <h2 class="text-3xl lg:text-4xl font-bold text-center mb-12" data-lang-key="nav.financing">Financing Details</h2>
                 <p class="text-center text-gray-600">Detailed content about Financing would go here...</p>
             </div>
        </section>
        <section id="news" class="py-16 lg:py-24 bg-white">
             <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl lg:text-4xl font-bold text-center mb-12 lg:mb-16" data-lang-key="news.title">News & Insights</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="flex flex-col bg-gray-50 rounded-lg shadow overflow-hidden hover:shadow-lg transition-shadow duration-300">
                        <img src="https://placehold.co/600x400/e5e7eb/4b5563?text=Market+Update" alt="News Image 1" class="w-full h-48 object-cover" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found'">
                        <div class="p-6 flex flex-col flex-grow">
                            <h3 class="text-lg font-semibold mb-2 text-gray-900" data-lang-key="news.card1_title">Market Outlook Q3 2025</h3>
                            <p class="text-gray-600 text-sm mb-4 flex-grow" data-lang-key="news.card1_desc">Our analysis of current market trends and potential opportunities for investors.</p>
                            <a href="#" class="mt-auto text-brand-red font-medium hover:underline text-sm self-start" data-lang-key="news.read_more">Read More &rarr;</a>
                        </div>
                    </div>
                     <div class="flex flex-col bg-gray-50 rounded-lg shadow overflow-hidden hover:shadow-lg transition-shadow duration-300">
                         <img src="https://placehold.co/600x400/d1d5db/374151?text=Retirement+Planning" alt="News Image 2" class="w-full h-48 object-cover" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found'">
                        <div class="p-6 flex flex-col flex-grow">
                            <h3 class="text-lg font-semibold mb-2 text-gray-900" data-lang-key="news.card2_title">Planning for a Secure Retirement</h3>
                            <p class="text-gray-600 text-sm mb-4 flex-grow" data-lang-key="news.card2_desc">Key considerations for building a robust pension plan in Switzerland.</p>
                            <a href="#" class="mt-auto text-brand-red font-medium hover:underline text-sm self-start" data-lang-key="news.read_more">Read More &rarr;</a>
                        </div>
                    </div>
                    <div class="flex flex-col bg-gray-50 rounded-lg shadow overflow-hidden hover:shadow-lg transition-shadow duration-300">
                         <img src="https://placehold.co/600x400/9ca3af/1f2937?text=Digital+Banking+Tips" alt="News Image 3" class="w-full h-48 object-cover" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found'">
                        <div class="p-6 flex flex-col flex-grow">
                            <h3 class="text-lg font-semibold mb-2 text-gray-900" data-lang-key="news.card3_title">Tips for Secure Digital Banking</h3>
                            <p class="text-gray-600 text-sm mb-4 flex-grow" data-lang-key="news.card3_desc">How to protect yourself while managing your finances online with BWAM.</p>
                            <a href="#" class="mt-auto text-brand-red font-medium hover:underline text-sm self-start" data-lang-key="news.read_more">Read More &rarr;</a>
                        </div>
                    </div>
                </div>
                 <div class="text-center mt-12">
                     <a href="#" class="inline-block bg-brand-red text-white font-semibold py-3 px-6 rounded-md hover:bg-opacity-85 transition duration-200 shadow" data-lang-key="news.more_news">More News</a>
                 </div>
            </div>
        </section>

        <section id="events" class="py-16 lg:py-24 bg-gray-100">
             <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-3xl lg:text-4xl font-bold mb-6" data-lang-key="events.title">Upcoming Events</h2>
                <p class="text-gray-600 mb-8 max-w-2xl mx-auto" data-lang-key="events.subtitle">Join us for insightful seminars and workshops. Register your interest below.</p>
                <div class="bg-white p-8 rounded-lg shadow-md max-w-md mx-auto">
                    <p class="text-gray-500 italic" data-lang-key="events.form_placeholder">(Event registration form will be here)</p>
                    </div>
            </div>
        </section>

        <section id="contact" class="py-16 lg:py-24 bg-white">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-3xl lg:text-4xl font-bold mb-6" data-lang-key="contact_cta.title">Contact BWAM</h2>
                <p class="text-gray-600 mb-8 max-w-2xl mx-auto" data-lang-key="contact_cta.subtitle">Our advisors are ready to help you achieve your financial goals. Reach out today.</p>
                <a href="#" class="inline-block bg-brand-red text-white font-semibold py-3 px-8 rounded-md text-lg hover:bg-opacity-85 transition duration-200 shadow-md" data-lang-key="contact_cta.button">Find an Advisor</a>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-gray-400 py-12">
         <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">BWAM</h4>
                    <p class="text-sm mb-4" data-lang-key="footer.tagline">Your reliable financial partner.</p>
                    <div class="flex space-x-4">
                        <a href="#" aria-label="Facebook" class="text-gray-400 hover:text-white"><svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"></path></svg></a>
                        <a href="#" aria-label="LinkedIn" class="text-gray-400 hover:text-white"><svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-4.499 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.59-11.018-3.714v-2.155z"></path></svg></a>
                        <a href="#" aria-label="Twitter" class="text-gray-400 hover:text-white"><svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-.424.727-.666 1.584-.666 2.477 0 1.486.758 2.796 1.909 3.562-.703-.022-1.365-.215-1.946-.536v.052c0 2.076 1.479 3.808 3.45 4.201-.36.099-.738.151-1.126.151-.278 0-.547-.027-.811-.076.546 1.697 2.133 2.934 4.012 2.969-1.469 1.147-3.319 1.83-5.334 1.83-.346 0-.686-.02-1.022-.061 1.89 1.213 4.129 1.921 6.566 1.921 7.883 0 12.207-6.534 12.207-12.207 0-.186-.004-.372-.012-.556.838-.604 1.564-1.36 2.145-2.23z"></path></svg></a>
                    </div>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4" data-lang-key="footer.quicklinks">Quick Links</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#home" class="hover:text-white transition-colors" data-lang-key="nav.private_clients">Private Clients</a></li>
                        <li><a href="#services" class="hover:text-white transition-colors" data-lang-key="nav.business_clients">Business Clients</a></li>
                        <li><a href="#" class="hover:text-white transition-colors" data-lang-key="footer.careers">Careers</a></li>
                        <li><a href="#contact" class="hover:text-white transition-colors" data-lang-key="footer.contact">Contact Us</a></li>
                        <li><a href="#news" class="hover:text-white transition-colors" data-lang-key="footer.newsroom">Newsroom</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4" data-lang-key="footer.services">Services</h4>
                     <ul class="space-y-2 text-sm">
                         <li><a href="#accounts-cards" class="hover:text-white transition-colors" data-lang-key="nav.accounts_cards">Accounts</a></li>
                         <li><a href="#investing" class="hover:text-white transition-colors" data-lang-key="nav.investing">Investing</a></li>
                         <li><a href="#" class="hover:text-white transition-colors" data-lang-key="footer.mortgages">Mortgages</a></li>
                         <li><a href="#pensions" class="hover:text-white transition-colors" data-lang-key="nav.pensions">Pensions</a></li>
                         <li><a href="#" class="hover:text-white transition-colors" data-lang-key="footer.digital_banking">Digital Banking</a></li>
                     </ul>
                </div>
                 <div>
                    <h4 class="text-lg font-semibold text-white mb-4" data-lang-key="footer.legal">Legal</h4>
                     <ul class="space-y-2 text-sm">
                         <li><a href="#" class="hover:text-white transition-colors" data-lang-key="footer.privacy">Privacy Policy</a></li>
                         <li><a href="#" class="hover:text-white transition-colors" data-lang-key="footer.terms">Terms of Use</a></li>
                         <li><a href="#" class="hover:text-white transition-colors" data-lang-key="footer.imprint">Imprint</a></li>
                         <li><a href="#" class="hover:text-white transition-colors" data-lang-key="footer.cookies">Cookie Settings</a></li>
                         <li><a href="#" class="hover:text-white transition-colors" data-lang-key="footer.accessibility">Accessibility</a></li>
                     </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-8 text-center text-sm text-gray-500">
                &copy; <span id="current-year"></span> BWAM. <span data-lang-key="footer.rights">All rights reserved.</span> <span data-lang-key="footer.location">Location: Z√ºrich, Switzerland.</span>
            </div>
        </div>
    </footer>

    <div id="consent-banner" class="fixed bottom-0 left-0 right-0 bg-gray-800 text-white p-4 shadow-lg z-[100] transform translate-y-full hidden" >
        <div class="container mx-auto flex flex-col sm:flex-row justify-between items-center gap-4">
            <p class="text-sm text-gray-300 flex-grow" data-consent-text="consent.message">
                Wir verwenden Cookies und √§hnliche Technologien, um Ihr Erlebnis zu verbessern und relevante Inhalte anzuzeigen. Indem Sie auf ‚ÄûAlle akzeptieren‚Äú klicken, stimmen Sie der Verwendung dieser Technologien zu. Sie k√∂nnen Ihre Auswahl jederzeit √§ndern. </p>
            <div class="flex-shrink-0 flex gap-3">
                <button id="consent-reject" class="bg-gray-600 hover:bg-gray-500 text-white text-sm font-medium py-2 px-4 rounded-md transition duration-150" data-consent-text="consent.reject">Alle ablehnen</button>
                <button id="consent-accept" class="bg-brand-red hover:bg-opacity-85 text-white text-sm font-medium py-2 px-4 rounded-md transition duration-150" data-consent-text="consent.accept">Alle akzeptieren</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>

```

**script.js:**


```javascript
// script.js

// --- Constants ---
const CONSENT_STORAGE_KEY = 'bwam_consent_status'; // Key for localStorage
const LOGIN_STATUS_KEY = 'bwam_logged_in_email'; // Key for sessionStorage
const SIMULATED_USER_ID = 'SIMULATED_USER_123'; // Placeholder User ID for simulation

// --- Language Data ---
const translations = { // Same as previous version...
    'de': {
        'page_title': 'BWAM - Ihr Finanzpartner',
        'nav.private_clients': 'Privatkunden',
        'nav.business_clients': 'Firmenkunden',
        'nav.institutional': 'Institutionelle',
        'nav.about_us': '√úber uns',
        'nav.events': 'Veranstaltungen',
        'nav.accounts_cards': 'Konto & Karten',
        'nav.investing': 'Anlegen',
        'nav.pensions': 'Vorsorgen',
        'nav.financing': 'Finanzieren',
        'nav.login': 'Anmelden',
        'aria.search': 'Suche',
        'aria.open_menu': 'Men√º √∂ffnen',
        'hero.title': 'Willkommen bei BWAM',
        'hero.subtitle': 'Ihr zuverl√§ssiger Partner f√ºr umfassende Finanzl√∂sungen in Z√ºrich und dar√ºber hinaus.',
        'hero.button_services': 'Dienstleistungen entdecken',
        'hero.button_contact': 'Kontakt aufnehmen',
        'service_card.accounts_cards': 'Konto & Karten',
        'service_card.investing': 'Sparen & Anlegen',
        'service_card.pensions': 'Vorsorgen',
        'service_card.financing': 'Finanzieren',
        'service_card.real_estate': 'Immobilien',
        'news.title': 'News & Insights',
        'news.card1_title': 'Marktausblick Q3 2025',
        'news.card1_desc': 'Unsere Analyse aktueller Markttrends und potenzieller Chancen f√ºr Investoren.',
        'news.card2_title': 'Planung f√ºr einen sicheren Ruhestand',
        'news.card2_desc': 'Wichtige √úberlegungen zum Aufbau eines soliden Vorsorgeplans in der Schweiz.',
        'news.card3_title': 'Tipps f√ºr sicheres Digital Banking',
        'news.card3_desc': 'Wie Sie sich sch√ºtzen, w√§hrend Sie Ihre Finanzen online mit BWAM verwalten.',
        'news.read_more': 'Mehr lesen ‚Üí',
        'news.more_news': 'Weitere News',
        'events.title': 'Kommende Veranstaltungen',
        'events.subtitle': 'Nehmen Sie an unseren aufschlussreichen Seminaren und Workshops teil. Melden Sie unten Ihr Interesse an.',
        'events.form_placeholder': '(Formular zur Veranstaltungsanmeldung kommt hier hin)',
        'contact_cta.title': 'Kontaktieren Sie BWAM',
        'contact_cta.subtitle': 'Unsere Berater helfen Ihnen gerne, Ihre finanziellen Ziele zu erreichen. Melden Sie sich noch heute.',
        'contact_cta.button': 'Berater finden',
        'footer.tagline': 'Ihr zuverl√§ssiger Finanzpartner.',
        'footer.quicklinks': 'Schnellzugriff',
        'footer.careers': 'Karriere',
        'footer.contact': 'Kontakt',
        'footer.newsroom': 'Newsroom',
        'footer.services': 'Dienstleistungen',
        'footer.mortgages': 'Hypotheken',
        'footer.digital_banking': 'Digital Banking',
        'footer.legal': 'Rechtliches',
        'footer.privacy': 'Datenschutz',
        'footer.terms': 'Nutzungsbedingungen',
        'footer.imprint': 'Impressum',
        'footer.cookies': 'Cookie-Einstellungen',
        'footer.accessibility': 'Barrierefreiheit',
        'footer.rights': 'Alle Rechte vorbehalten.',
        'footer.location': 'Standort: Z√ºrich, Schweiz.',
        'consent.message': 'Wir verwenden Cookies und √§hnliche Technologien, um Ihr Erlebnis zu verbessern und relevante Inhalte anzuzeigen. Indem Sie auf ‚ÄûAlle akzeptieren‚Äú klicken, stimmen Sie der Verwendung dieser Technologien zu. Sie k√∂nnen Ihre Auswahl jederzeit √§ndern.',
        'consent.reject': 'Alle ablehnen',
        'consent.accept': 'Alle akzeptieren'
    },
    'en': { // Same as previous version...
        'page_title': 'BWAM - Your Financial Partner',
        'nav.private_clients': 'Private Clients',
        'nav.business_clients': 'Business Clients',
        'nav.institutional': 'Institutional',
        'nav.about_us': 'About Us',
        'nav.events': 'Events',
        'nav.accounts_cards': 'Accounts & Cards',
        'nav.investing': 'Investing',
        'nav.pensions': 'Pensions',
        'nav.financing': 'Financing',
        'nav.login': 'Login',
        'aria.search': 'Search',
        'aria.open_menu': 'Open menu',
        'hero.title': 'Welcome to BWAM',
        'hero.subtitle': 'Your trusted partner for comprehensive financial solutions in Z√ºrich and beyond.',
        'hero.button_services': 'Explore Services',
        'hero.button_contact': 'Contact Us',
        'service_card.accounts_cards': 'Accounts & Cards',
        'service_card.investing': 'Savings & Investments',
        'service_card.pensions': 'Pensions',
        'service_card.financing': 'Financing',
        'service_card.real_estate': 'Real Estate',
        'news.title': 'News & Insights',
        'news.card1_title': 'Market Outlook Q3 2025',
        'news.card1_desc': 'Our analysis of current market trends and potential opportunities for investors.',
        'news.card2_title': 'Planning for a Secure Retirement',
        'news.card2_desc': 'Key considerations for building a robust pension plan in Switzerland.',
        'news.card3_title': 'Tips for Secure Digital Banking',
        'news.card3_desc': 'How to protect yourself while managing your finances online with BWAM.',
        'news.read_more': 'Read More ‚Üí',
        'news.more_news': 'More News',
        'events.title': 'Upcoming Events',
        'events.subtitle': 'Join us for insightful seminars and workshops. Register your interest below.',
        'events.form_placeholder': '(Event registration form will be here)',
        'contact_cta.title': 'Contact BWAM',
        'contact_cta.subtitle': 'Our advisors are ready to help you achieve your financial goals. Reach out today.',
        'contact_cta.button': 'Find an Advisor',
        'footer.tagline': 'Your reliable financial partner.',
        'footer.quicklinks': 'Quick Links',
        'footer.careers': 'Careers',
        'footer.contact': 'Contact Us',
        'footer.newsroom': 'Newsroom',
        'footer.services': 'Services',
        'footer.mortgages': 'Mortgages',
        'footer.digital_banking': 'Digital Banking',
        'footer.legal': 'Legal',
        'footer.privacy': 'Privacy Policy',
        'footer.terms': 'Terms of Use',
        'footer.imprint': 'Imprint',
        'footer.cookies': 'Cookie Settings',
        'footer.accessibility': 'Accessibility',
        'footer.rights': 'All rights reserved.',
        'footer.location': 'Location: Z√ºrich, Switzerland.',
        'consent.message': 'We use cookies and similar technologies to enhance your experience and display relevant content. By clicking "Accept All," you agree to the use of these technologies. You can change your selection at any time.',
        'consent.reject': 'Reject All',
        'consent.accept': 'Accept All'
    }
};

// --- Language Switching Function ---
function setLanguage(lang) {
    if (!translations[lang]) { console.error(`Lang ${lang} not found.`); return; }
    document.documentElement.lang = lang;
    document.querySelectorAll('[data-lang-key], [data-consent-text]').forEach(el => {
        const key = el.getAttribute('data-lang-key') || el.getAttribute('data-consent-text');
        const txt = translations[lang][key];
        if (txt !== undefined) {
            if (key?.startsWith('aria.') || key === 'page_title') {
                if (key === 'page_title') { document.title = txt; } else { el.setAttribute(key.split('.')[0], txt); }
            } else { el.textContent = txt; }
        } else { console.warn(`Translation key "${key}" missing for lang "${lang}".`); }
    });
    document.querySelectorAll('.lang-button').forEach(btn => btn.classList.toggle('active', btn.getAttribute('data-lang') === lang));
    try { localStorage.setItem('bwam_preferred_lang', lang); } catch (e) { console.warn("Could not save lang preference."); }

    // --- SF Language Change Tracking ---
    if (typeof salesforceSDKInitialized !== 'undefined' && salesforceSDKInitialized) {
        SalesforceInteractions.sendEvent({
            interaction: { name: 'Changed Language', attributes: { selectedLanguage: lang } },
            user: { attributes: typeof userLocationData !== 'undefined' && userLocationData && !userLocationData.error ? userLocationData : {} }
        });
        console.log(`Tracked Language Change: ${lang}`);
    }
}

// --- Simple Hash-Based Page/Section Visibility ---
function handleHashChange() {
    const hash = window.location.hash.substring(1);
    console.log(`Hash changed to: #${hash}`);
    document.querySelectorAll('main > section').forEach(section => section.classList.add('hidden'));
    let sectionToShowId = 'home';
    if (hash && document.getElementById(hash)) { sectionToShowId = hash; }
    else if (hash) { console.warn(`Section for hash #${hash} not found, showing home.`); }
    const sectionToShow = document.getElementById(sectionToShowId);
    if (sectionToShow) { sectionToShow.classList.remove('hidden'); console.log(`Showing section: #${sectionToShowId}`); }
    else { document.getElementById('home')?.classList.remove('hidden'); console.log(`Fallback: Showing section: #home`); }
    // NOTE: Page View event is now automatically handled by initSitemap on hash change
}

// --- Salesforce Interaction Tracking Function ---
function attachTrackingListeners() {
    console.log("Attaching SF interaction listeners.");

    // Helper to send interaction events
    function sendSalesforceClickInteraction(event, targetName, customAttributes = {}) {
        // Ensure SDK is ready before sending
        if (typeof salesforceSDKInitialized !== 'undefined' && salesforceSDKInitialized && typeof SalesforceInteractions !== 'undefined') {
            const targetElement = event.currentTarget;
            const payload = {
                interaction: { name: 'Web Click', targetUrl: targetElement.href || '', targetElementText: targetElement.innerText?.trim().substring(0, 255) || '', targetElementSelector: getCssSelector(targetElement), attributes: { targetName: targetName, ...customAttributes } },
                user: { attributes: typeof userLocationData !== 'undefined' && userLocationData && !userLocationData.error ? userLocationData : {} }
            };
            SalesforceInteractions.sendEvent(payload);
        } else { console.warn("SF SDK not ready, click event not sent:", targetName); }
    }

    // Helper function to generate CSS selector
    function getCssSelector(el) { if (!(el instanceof Element)) return; const path = []; while (el.nodeType === Node.ELEMENT_NODE) { let selector = el.nodeName.toLowerCase(); if (el.id) { selector += '#' + el.id; path.unshift(selector); break; } else { let sib = el, nth = 1; while (sib = sib.previousElementSibling) { if (sib.nodeName.toLowerCase() == selector) nth++; } if (nth != 1) selector += ":nth-of-type("+nth+")"; } path.unshift(selector); el = el.parentNode; } return path.join(" > "); }

    // Attach Listeners
    document.querySelector('[data-lang-key="hero.button_services"]')?.addEventListener('click', (e) => { sendSalesforceClickInteraction(e, 'Hero CTA - Explore Services', { targetSection: 'services' }); console.log('Tracked Hero CTA click'); });
    document.querySelector('[data-lang-key="hero.button_contact"]')?.addEventListener('click', (e) => { sendSalesforceClickInteraction(e, 'Hero CTA - Contact Us', { targetSection: 'contact' }); console.log('Tracked Hero Contact click'); });
    document.querySelectorAll('#news [data-lang-key="news.read_more"]').forEach(link => { link.addEventListener('click', (e) => { if (link.getAttribute('href') === '#') { e.preventDefault(); } const card = e.target.closest('.flex-col'); const title = card?.querySelector('h3[data-lang-key]')?.textContent.trim() ?? 'Unknown'; sendSalesforceClickInteraction(e, 'News Read More', { articleTitle: title, cardPosition: card?.parentNode ? Array.from(card.parentNode.children).indexOf(card) + 1 : 'Unknown' }); console.log(`Tracked News Read More: ${title}`); }); });
    document.querySelectorAll('#services .group').forEach(link => { link.addEventListener('click', (e) => { const title = link.querySelector('h3[data-lang-key]')?.textContent.trim() ?? 'Unknown'; const key = link.querySelector('h3[data-lang-key]')?.getAttribute('data-lang-key').replace('service_card.', '') ?? 'unknown'; sendSalesforceClickInteraction(e, 'Service Icon Click', { serviceName: title, serviceKey: key }); console.log(`Tracked Service Icon: ${title}`); }); });
    document.querySelector('#contact [data-lang-key="contact_cta.button"]')?.addEventListener('click', (e) => { if (e.currentTarget.getAttribute('href') === '#') { e.preventDefault(); } sendSalesforceClickInteraction(e, 'Contact CTA - Find Advisor'); console.log('Tracked Contact CTA click'); });
    // Listener for the main "Login" button (to show the form)
    document.querySelector('#login-button')?.addEventListener('click', (e) => { sendSalesforceClickInteraction(e, 'Header Login Prompt'); console.log('Tracked click to show login form'); });
    document.querySelectorAll('header .dropdown-menu a[role="menuitem"]').forEach(link => { link.addEventListener('click', (e) => { const key = link.getAttribute('data-lang-key'); const text = link.textContent.trim(); sendSalesforceClickInteraction(e, 'Private Client Submenu Click', { linkKey: key, linkText: text }); console.log(`Tracked Submenu click: ${text}`); }); });

} // --- End of attachTrackingListeners ---
window.attachTrackingListeners = attachTrackingListeners; // Make global

// --- User Identification Function ---
function handleSuccessfulLogin(userId, userEmail) {
    if (typeof salesforceSDKInitialized !== 'undefined' && salesforceSDKInitialized && userId) {
        SalesforceInteractions.identify({ identityType: SalesforceInteractions.SalesforceInteractionsConstants.IdentityType.CustomerId, id: userId });
        if (userEmail) { SalesforceInteractions.identify({ identityType: SalesforceInteractions.SalesforceInteractionsConstants.IdentityType.EmailAddress, id: userEmail }); }
        SalesforceInteractions.sendEvent({ user: { attributes: { loginStatus: "Logged In", lastLoginDate: new Date().toISOString(), email: userEmail || '', ...(typeof userLocationData !== 'undefined' && userLocationData && !userLocationData.error && { latitude: userLocationData.latitude, longitude: userLocationData.longitude }) } } });
        console.log(`SF SDK: Identified user: ${userId} (${userEmail || 'No email'})`);
    } else { console.warn(`SF SDK: Could not identify user. SDK Initialized: ${salesforceSDKInitialized}, User ID: ${!!userId}`); }
}
window.handleSuccessfulLogin = handleSuccessfulLogin; // Make global

// --- Logout Function ---
function handleLogout() {
    const loggedInEmail = sessionStorage.getItem(LOGIN_STATUS_KEY);
    console.log(`Logging out user: ${loggedInEmail || 'Unknown'}`);
    sessionStorage.removeItem(LOGIN_STATUS_KEY);
    updateLoginUI(false); // Update UI
    if (typeof salesforceSDKInitialized !== 'undefined' && salesforceSDKInitialized) {
        SalesforceInteractions.sendEvent({ interaction: { name: 'User Logout' }, user: { attributes: typeof userLocationData !== 'undefined' && userLocationData && !userLocationData.error ? userLocationData : {} } });
        console.log("Sent User Logout event to Salesforce.");
    }
}
window.handleLogout = handleLogout; // Make global


// --- Global UI Update Function --- (Defined later in DOMContentLoaded)
let updateLoginUI = () => {};

// --- Initial Page Load Logic ---
document.addEventListener('DOMContentLoaded', () => {

    // --- Element Selectors ---
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const currentYearSpan = document.getElementById('current-year');
    const langButtons = document.querySelectorAll('.lang-button');
    const consentBanner = document.getElementById('consent-banner');
    const acceptBtn = document.getElementById('consent-accept');
    const rejectBtn = document.getElementById('consent-reject');
    const loginButton = document.getElementById('login-button');
    const loginForm = document.getElementById('login-form');
    const loginEmailInput = document.getElementById('login-email');
    const simulateLoginButton = document.getElementById('simulate-login-button');
    const loggedInStatusDiv = document.getElementById('logged-in-status');
    const loggedInEmailSpan = document.getElementById('logged-in-email');
    const logoutButton = document.getElementById('logout-button');

    // --- Consent Banner Logic ---
    // Show banner if consent not set, and attach button listeners
    if (consentBanner && acceptBtn && rejectBtn) {
        let consentStatus = null;
        try { consentStatus = localStorage.getItem(CONSENT_STORAGE_KEY); }
        catch (e) { console.error("localStorage consent check failed.", e); }

        // Show banner only if no choice has been made
        if (!consentStatus) {
            console.log("Consent not set, showing banner via DOMContentLoaded.");
            consentBanner.classList.remove('hidden');
            setTimeout(() => { consentBanner.style.transform = 'translateY(0)'; }, 50); // Animate in
        } else {
             console.log(`Consent already set to: ${consentStatus}. Banner remains hidden.`);
        }

        // Attach listeners regardless of initial state
        acceptBtn.addEventListener('click', () => {
            console.log("Consent Accepted button clicked.");
            try { localStorage.setItem(CONSENT_STORAGE_KEY, 'accepted'); } catch (e) { console.error("localStorage consent save failed.", e); }
            consentBanner.style.transform = 'translateY(100%)';
            setTimeout(() => { consentBanner.classList.add('hidden'); }, 300);

            // Send Consent Accepted Event
             if (typeof SalesforceInteractions !== 'undefined' && typeof SalesforceInteractions.sendEvent === 'function') {
                 SalesforceInteractions.sendEvent({ interaction: { name: 'Consent Accepted', attributes: { consentType: 'All' } }, user: { attributes: typeof userLocationData !== 'undefined' && userLocationData && !userLocationData.error ? userLocationData : {} } });
             } else {
                 console.warn("SF SDK not ready to send Consent Accepted event.");
             }
             // Initialize SDK
            if (typeof initializeSalesforceSDK === 'function') {
                initializeSalesforceSDK();
            } else { console.error("initializeSalesforceSDK function not found!"); }
        });

        rejectBtn.addEventListener('click', () => {
            console.log("Consent Rejected button clicked.");
            try { localStorage.setItem(CONSENT_STORAGE_KEY, 'rejected'); } catch (e) { console.error("localStorage consent save failed.", e); }
            consentBanner.style.transform = 'translateY(100%)';
            setTimeout(() => { consentBanner.classList.add('hidden'); }, 300);
             // Send Consent Rejected Event
             if (typeof SalesforceInteractions !== 'undefined' && typeof SalesforceInteractions.sendEvent === 'function') {
                 SalesforceInteractions.sendEvent({ interaction: { name: 'Consent Rejected', attributes: { consentType: 'All' } } });
             }
        });
    } else { console.warn("Consent banner elements missing."); }

    // --- Login Simulation Logic ---
    // Define the UI update function within this scope
    updateLoginUI = (isLoggedIn, email = '') => {
        const loginBtn = document.getElementById('login-button');
        const form = document.getElementById('login-form');
        const statusDiv = document.getElementById('logged-in-status');
        const emailSpan = document.getElementById('logged-in-email');
        const emailInput = document.getElementById('login-email');
        if (!loginBtn || !form || !statusDiv || !emailSpan || !emailInput) { console.warn("Login UI elements missing for update."); return; }
        if (isLoggedIn) {
            loginBtn.classList.add('hidden');
            form.classList.add('hidden');
            statusDiv.classList.remove('hidden'); statusDiv.classList.add('flex');
            emailSpan.textContent = email;
        } else {
            loginBtn.classList.remove('hidden');
            form.classList.add('hidden');
            statusDiv.classList.add('hidden'); statusDiv.classList.remove('flex');
            emailSpan.textContent = ''; emailInput.value = '';
        }
    }

    // Setup Login Listeners only if all elements are found
    if (loginButton && loginForm && loginEmailInput && simulateLoginButton && loggedInStatusDiv && loggedInEmailSpan && logoutButton) {
        const initialEmail = sessionStorage.getItem(LOGIN_STATUS_KEY);
        updateLoginUI(!!initialEmail, initialEmail || '');

        loginButton.addEventListener('click', () => {
            loginButton.classList.add('hidden');
            loginForm.classList.remove('hidden');
            loginEmailInput.focus();
            // Tracking moved to attachTrackingListeners
        });

        simulateLoginButton.addEventListener('click', () => {
            const email = loginEmailInput.value.trim();
            if (email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                console.log(`Simulating login for: ${email}`);
                sessionStorage.setItem(LOGIN_STATUS_KEY, email);
                updateLoginUI(true, email);
                 // Send click event for the simulate login button itself
                 if (typeof salesforceSDKInitialized !== 'undefined' && salesforceSDKInitialized) {
                     SalesforceInteractions.sendEvent({ interaction: { name: 'Web Click', attributes: { targetName: 'Simulate Login Button' } } });
                 }
                 // Identify the user
                if (typeof handleSuccessfulLogin === 'function') { handleSuccessfulLogin(SIMULATED_USER_ID, email); }
                else { console.warn("handleSuccessfulLogin not available."); }
            } else { alert('Please enter a valid email address.'); }
        });

        logoutButton.addEventListener('click', () => {
            if (typeof handleLogout === 'function') { handleLogout(); }
            else { console.error("handleLogout function not found!"); }
        });

    } else { console.warn("Login simulation elements missing. Login UI inactive."); }

    // --- Other Initializations ---
    if (mobileMenuButton && mobileMenu) { mobileMenuButton.addEventListener('click', () => { mobileMenuButton.setAttribute('aria-expanded', !(mobileMenuButton.getAttribute('aria-expanded') === 'true')); mobileMenu.classList.toggle('hidden'); }); }
    mobileMenu?.querySelectorAll('a').forEach(link => { link.addEventListener('click', () => { if (!mobileMenu.classList.contains('hidden')) { mobileMenu.classList.add('hidden'); mobileMenuButton.setAttribute('aria-expanded', 'false'); } }); });
    // Ensure language buttons have listeners attached correctly
    langButtons.forEach(button => {
        button.addEventListener('click', () => {
            const lang = button.getAttribute('data-lang');
            console.log(`Language button clicked: ${lang}`); // Debug log
            setLanguage(lang);
        });
    });
    if (currentYearSpan) { currentYearSpan.textContent = new Date().getFullYear(); }
    let preferredLang = 'de';
    try { const savedLang = localStorage.getItem('bwam_preferred_lang'); if (savedLang && translations[savedLang]) { preferredLang = savedLang; } } catch(e) { console.warn("Could not read lang preference."); }
    setLanguage(preferredLang); // Apply language (this will also translate the banner if it's visible)
    handleHashChange(); // Initial section display
    window.addEventListener('hashchange', handleHashChange); // Listen for SPA navigation

    console.log("BWAM Script Loaded. Initial language:", preferredLang);
}); // End of DOMContentLoaded

